---
- name: set unit attributes
  set_fact:
    unit_path: "{{ unit.value.path|default(default_unit_path) }}"
    unit_type: "{{ unit.value.type|default(default_unit_type) }}"

- name: Check if unit configuration exists.
  stat:
    path: "{{ unit_path }}/{{ unit.key }}.{{ unit_type }}"
  register: unit_path_stat

- debug:
    msg: "{{ unit_path_stat }} :: {{ unit.value }}"

- name: Copy unit configurations in place
  template:
    src: "systemd.unit.j2"
    dest: "{{ unit_path }}/{{ unit.key }}.{{ unit_type }}"
    owner: "root"
    group: "root"
    mode: 0644
  vars:
    config: "{{ unit.value }}"
